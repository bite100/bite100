# 主网上线与优化总览

> 基于 GitHub 仓库 [P2P-P2P/p2p](https://github.com/P2P-P2P/p2p) 的项目状态与主网上线焦点汇总  
> 时间线：2026-02-09 JST 11:26 AM  
> 关联：[项目分析与借鉴](./项目分析与借鉴.md)、[项目价值与定位](./项目价值与定位.md)、[优化与改进清单](./优化与改进清单.md)

---

## 一、项目现状（Phase 3 已完成）

**仓库**：P2P-P2P/p2p — 基于 Ethereum 的去中心化 P2P 交易所。

**已完成**：
- **libp2p + GossipSub** P2P 订单撮合
- **WebSocket** 实时订单簿
- **EIP-712** 签名
- **Settlement** 合约链上原子结算
- **Relayer** 代付 gas

**核心**：手机浏览器即用（PWA）、无 KYC/无托管、自定义手续费分成。

**Sepolia 测试网部署**（示例）：
- Vault: `0xbe3962Eaf7103d05665279469FFE3573352ec70C`
- Settlement: `0x493Da680973F6c222c89eeC02922E91F1D9404a0`
- 其他合约见 [API-接口说明](./API-接口说明.md)、[部署与使用说明](./部署与使用说明.md)

**开发者焦点**：主网上线激励、防 Sybil、部署自动化、差异化优化。

---

## 二、项目分析 & 类似 DEX 对比

**定位**：真 P2P 订单簿（零滑点限价单）+ relayer gasless + 手机优先，挑战 Uniswap 等 AMM 的中心化路由。

### 对比表（2026 视角）

| 维度 | 本项目 | Bisq/Haveno（P2P 前辈） | dYdX v4/Hyperliquid（订单簿） | Uniswap v4（AMM） |
|------|--------|--------------------------|-------------------------------|-------------------|
| **撮合** | libp2p GossipSub | Tor 多签 P2P | 链上订单簿 | 流动性池 |
| **隐私** | 高（无中心路由） | 极高（Tor） | 中 | 中（链上可见） |
| **Gas** | Relayer 代付 | 用户自付 | 优化/低 gas | 用户自付 |
| **易用** | 手机 PWA | 桌面节点 | Web/App | Web/App |
| **TVL/活跃** | 早期（stars ~0） | 中（BTC/fiat 专注） | 高（衍生品主导） | 最高（数十亿） |

**借鉴建议**：
- Bisq：Tor + 多签仲裁
- DCRDEX：原子交换 + epoch 匹配
- Haveno：种子节点发现

**本项目优势**：relayer + 手机浏览器（主流 DEX 无此低门槛）。详见 [项目分析与借鉴](./项目分析与借鉴.md)、[项目价值与定位](./项目价值与定位.md)。

---

## 三、部署 & 运行优化（电脑端 / VPS 一键 + 自动更新）

### 3.1 Docker Compose 一键完整环境

- 根目录 `docker-compose.yml`，服务：**node**（Go libp2p、MatchEngine、WebSocket）
- 端口：4001（libp2p）、8080（WS）

```bash
git clone https://github.com/P2P-P2P/p2p.git && cd p2p
docker compose up -d   # 启动 node 中枢 + 辅助
docker compose logs -f node
cd frontend && npm run dev   # 浏览器 http://localhost:5173 连本地 WS
```

### 3.2 电脑端（已放弃）

- **已放弃电脑端/桌面安装包**，以 PWA/浏览器为主；不再提供 Setup.exe 与 Electron-updater。
- **CLI 开发/节点**：`scripts/start-dev.ps1` / `.sh` + Makefile 仍可用于本地开发与节点运行。
- 此前：强制浏览器交易、Windows Setup.exe + Electron-updater（见 [项目分析与借鉴 - 电脑端](./项目分析与借鉴.md#三电脑端--vps-部署优化)）。

### 3.3 VPS（Ubuntu 等）

- `install-node.sh` + systemd：`/etc/systemd/system/p2p-hub.service`
- **cron 自动更新**：

```bash
# scripts/auto-update.sh
cd /path/to/p2p && git pull && docker compose pull && docker compose up -d
# crontab: 0 3 * * * /path/to/auto-update.sh
```

- **节点中枢**：Go `node/` 运行（GossipSub 广播、撮合），暴露 WS 给前端；Bootstrap 见 [节点发现与Bootstrap](./节点发现与Bootstrap.md)。

详见 [部署与使用说明](./部署与使用说明.md)、[优化与改进清单 - 电脑端/VPS](./优化与改进清单.md#十一电脑端--vps-部署与自动更新中优先级)。

---

## 四、Relayer 代付 Gas 机制（核心差异化）

- **Settlement.sol**：`setRelayer` + `settleTrade` 8 参数；用户 EIP-712 签名订单 → relayer 验证/打包/上链/垫付 gas → 从 FeeDistributor 手续费补偿。
- **实现路径**：自定义 relayer（节点运营者竞标）→ 未来集成 OpenGSN/ERC-2771（meta-tx）。
- **风险优化**：多 relayer + Governance 切换（见 [项目分析与借鉴 - 增强去中心化](./项目分析与借鉴.md#21-增强去中心化)）。
- **前端**：`frontend/src/config.ts` + ethers.js，提示「gasless，无需 ETH」。

详见 [API-接口说明 - Settlement](./API-接口说明.md)、[技术架构说明](./技术架构说明.md)。

---

## 五、主网上线激励机制（开发者积分 + 节点奖励）

- **规则**：仅上线时发放；**1 开发者积分 = 1 USDT**（从手续费/募资池，无预资金）。节点奖励按周期池子与贡献分占比，不按 1:1 USDT（见 [项目分析与借鉴 §4.0](./项目分析与借鉴.md#40-节点奖励等按各自规则与池子分配当前情况)）。
- **绑定钱包**：前端/CLI/节点 `.env` 中 `REWARD_WALLET=0x...`；链上 ContributorReward 记录。
- **记录**：ContributorReward（Sepolia 示例：`0x851019107c4F3150D90f1629f6A646eBC1B1E286`）存 `devPoints` / `nodePoints`（或等价 mapping）。
- **领取**：统一 `claimRewards()`（开发者积分 + 节点积分 → 转 USDT 或按周期锁定价值领取）。

**合约扩展草稿**（ContributorReward.sol）：

```solidity
mapping(address => uint256) public devPoints;   // 上线前 Governance allocate
mapping(address => uint256) public nodePoints;  // 运行时长/撮合累积
function claimRewards() external {
    uint256 total = devPoints[msg.sender] + nodePoints[msg.sender];
    require(total > 0);
    IERC20(USDT).transfer(msg.sender, total * 1e6);
    devPoints[msg.sender] = nodePoints[msg.sender] = 0;
}
```

**流程**：上线前 snapshot（GitHub PR + 节点心跳）→ Governance 提案批量 allocate → Merkle airdrop / claim。

**贡献最高**：P2P-P2P（仓库主，~28 commits 主导代码/docs/合约，GitHub graphs/contributors 第一）。

详见 [上线奖励分发机制实现指南](./上线奖励分发机制实现指南.md)、[贡献奖励接口](./贡献奖励接口.md)。

---

## 六、防 Sybil 攻击（无资金前提）

**非经济机制**（上线无 USDT 池时）：
- **声誉系统**：`reputationScore`（心跳/撮合共识，GossipSub 验证）
- **网络延迟检测**：libp2p ping 相似延迟 → 拒绝多节点（`node/` Go 集成）
- **分层信任**：新钱包 Cadet（低权重）→ Trusted（>7 天 + 订单证明）
- **绑定限制**：1–3 节点/钱包 + EIP-712 签名 + 社交证明（GitHub/X）
- **Governance 挑战**：社区提案黑名单（证据：IP 集群）

**Roadmap**：Sepolia 测试 NodeRegistry.sol → 节点心跳上报 → 上线 snapshot 过滤。

详见 [项目分析与借鉴 - 防 Sybil](./项目分析与借鉴.md#45-防-sybil一个钱包控制多节点)、[优化与改进清单 - 架构增强](./优化与改进清单.md#十二架构增强来自对标与借鉴)。

---

## 七、整体优化建议 & 下一步

### 7.1 项目结构

- **contracts/**：Foundry Solidity
- **frontend/**：React/Vite/ethers/PWA
- **node/**：Go/libp2p/MatchEngine
- **docs/**：中文为主，含主网/Polygon 指南

### 7.2 上线 Checklist

- [ ] 主网/Polygon 部署（`npm run build:mainnet`）
- [ ] Tor 集成（可选）
- [ ] Relayer 去中心化（多 relayer + 治理）
- [ ] 积分 snapshot 脚本（如 Python web3.py）
- [ ] 防 Sybil：NodeRegistry + 心跳 + snapshot 过滤
- [ ] 部署自动化：Docker Compose 一键、VPS systemd + cron（Electron-updater 已放弃）

详见 [主网部署指南](./主网部署指南.md)、[优化与改进清单](./优化与改进清单.md)、[规划与路线图](./规划与路线图.md)。

---

*本文档为 2026-02-09 状态与焦点汇总，以当时修改为准；细节以各专题文档为准。*
