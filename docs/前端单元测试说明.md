# 前端单元测试说明

> 前端使用 [Vitest](https://vitest.dev/) 做单元测试，与 Vite 5 同构、零配置即可运行。

## 运行方式

```bash
cd frontend
npm run test        # 单次运行
npm run test:watch  # 监听模式
```

## 当前覆盖

| 文件 | 说明 |
|------|------|
| `src/utils.test.ts` | 工具函数：`formatTokenAmount`、`shortAddress`、`isValidAddress`、`formatError`、简单缓存 |
| `src/nodeClient.test.ts` | 多节点回退：`tryNodes`（首节点成功/回退到第三节点/全部失败）、`nodeGet`（fetch + 参数）、`nodePost`（POST body）；mock `./config` 与 `fetch` |
| `src/config/chains.test.ts` | 链配置纯函数：`getChainConfig`、`isChainSupported`、`getAddChainParams`、`DEFAULT_CHAIN_ID`、`CHAIN_CONFIGS` 结构 |
| `src/hooks/useTokenPrice.test.ts` | 价格 hook：`PAIR_COINGECKO_IDS`、`useTokenPrice`（loading/price/error、refetch）、`usePairMarketPrice`（mock fetch，jsdom） |
| `src/hooks/useOrderBook.test.ts` | 订单簿 hook：初始空 bids/asks、`orderbook-update` 同 pair 时更新、不同 pair 时忽略 |
| `src/hooks/useMyOrders.test.ts` | 我的订单 hook：trader 为空不访问 IndexedDB，有 trader 时调用 `OrderStorage.getUserOrders` 并更新状态（mock Dexie 存储） |

## 配置文件

- **vitest.config.ts**：根目录在 `frontend/`，测试文件匹配 `**/*.test.ts` / `**/*.spec.ts`，环境 **jsdom**（hook 测试需要；node 风格测试在 jsdom 下也可运行）。

## 依赖

- **vitest**、**@testing-library/react**、**jsdom**（hook 测试）。

## 后续可做

- 为其他 hooks（如 useChain）或页面组件增加单测/集成测试。

**最后更新**：2026-02-08
