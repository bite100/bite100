# 设计文档索引

> 本仓库设计类文档 **以当时修改为准**，实现与配置与之对齐；有变更时 **随时更新设计文档**。修改时 **保留更改以前的说明**（如「此前规定」「变更说明」），便于分析演变与原因。  
> **写代码时要结合整个项目来考虑**（前端、节点、合约、脚本、文档等），避免单点改动导致不一致。

**文档合并说明**（2026-02-10）：跨链桥接 3 合 1 → [跨链桥接完整指南](./跨链桥接完整指南.md)；安装包构建 2 合 1 → [安装包构建指南](./安装包构建指南.md)；桌面版钱包问题排查已合并至 [桌面版钱包连接无反应排查](./桌面版钱包连接无反应排查.md)。

---

## 推荐阅读顺序

| 读者 | 建议路径 |
|------|----------|
| 新手 / 想快速跑起来 | [快速开始](./快速开始.md) → [部署与使用说明](./部署与使用说明.md) |
| 开发 / 了解架构 | [概念设计文档](./概念设计文档.md) → [技术架构说明](./技术架构说明.md) → [Phase2](./Phase2-设计文档.md) / [Phase3](./Phase3-设计文档.md) |
| 节点与撮合整合 | [快速开始](./快速开始.md) → [P2P节点整合交易撮合指南](./P2P节点整合交易撮合指南.md)（含快速步骤与完整内容） |
| 运维 / 部署 | [部署与使用说明](./部署与使用说明.md) → [节点部署](./节点部署.md) → [主网部署指南](./主网部署指南.md) |

---

## 按功能模块查阅（与 Skill 对齐）

**全项目按功能优化时**：先查 [.cursor/skills/p2p-dex-project/SKILL.md](../.cursor/skills/p2p-dex-project/SKILL.md) 的「功能模块 Skill 索引」与「按功能优化：代码与文档入口」，再改对应代码/文档，避免破坏不可变约束。

| 功能 | Skill | 相关文档（主要） | 主要代码位置 |
|------|-------|------------------|--------------|
| 订单签名 | order-signing | [API-接口说明](./API-接口说明.md)、[贡献奖励接口](./贡献奖励接口.md)、[公开API文档](./公开API文档.md) | frontend/services/orderSigning、orderVerification；node/internal/match/signature.go |
| 链上结算 | settlement-chain | [API-接口说明](./API-接口说明.md)、[技术架构说明](./技术架构说明.md) | contracts/Settlement.sol；node/internal/settlement/；frontend 结算调用 |
| 资金托管 | vault-deposit-withdraw | [API-接口说明](./API-接口说明.md) | contracts/Vault.sol；frontend 存提与 ABI |
| AMM/Swap | amm-swap | [API-接口说明](./API-接口说明.md) | contracts/AMMPool*.sol；frontend Swap/流动性 |
| 手续费与治理 | fee-governance | [API-接口说明](./API-接口说明.md)、[治理部署与提案执行指南](./治理部署与提案执行指南.md) | contracts/FeeDistributor、Governance；frontend GovernanceSection、governanceUtils |
| 贡献分 | contributor-reward | [贡献奖励接口](./贡献奖励接口.md)、[贡献分领取机制实现指南](./贡献分领取机制实现指南.md) | contracts/ContributorReward；node/internal/reward、metrics；frontend UnifiedRewardClaim、contributorRewardUtils |
| 订单簿与撮合 | orderbook-match | [技术架构说明](./技术架构说明.md)、[P2P节点整合交易撮合指南](./P2P节点整合交易撮合指南.md) | node/internal/match、storage、sync；frontend OrderBookSection、OrderForm、nodeClient、wsClient |
| P2P 节点与中继 | p2p-node-relay | [节点部署](./节点部署.md)、[Relay部署与Nginx](./Relay部署与Nginx.md)、[节点发现与Bootstrap](./节点发现与Bootstrap.md) | node/internal/p2p、relay；config.example.yaml |
| 前端主流程 | frontend-ux | [部署与使用说明](./部署与使用说明.md)、[前端验证-订单簿](./前端验证-订单簿.md)、[部署-Railway与Fly](./部署-Railway与Fly.md) § 前端功能模块 | frontend/App、walletConfig、config/chains、ChainSwitcher |
| 跨链桥接 | cross-chain-bridge | [跨链桥接完整指南](./跨链桥接完整指南.md) | contracts/CrossChainBridge；frontend CrossChainBridge |
| PWA 与移动端 | pwa-mobile | [手机端开发指南](./手机端开发指南.md)、[手机端架构与数据保存策略](./手机端架构与数据保存策略.md) | frontend/public/manifest、sw.js；ServiceWorkerUpdate、MobileConnectHint |
| 节点 API | node-api | [API-接口说明](./API-接口说明.md)、[公开API文档](./公开API文档.md)、[节点部署](./节点部署.md) | node/internal/api；frontend nodeClient、wsClient |
| 贡献证明 | contribution-proof | [贡献奖励接口](./贡献奖励接口.md)、[Phase2-设计文档](./Phase2-设计文档.md) | node/metrics、reward；contracts ContributorReward；证明 payload/签名 |
| 数据保留 | data-retention | [Phase2-设计文档](./Phase2-设计文档.md)、[技术架构说明](./技术架构说明.md) | node/internal/storage 保留与清理 |
| 安全与防滥用 | spam-security | [技术架构说明](./技术架构说明.md)、[优化与改进清单](./优化与改进清单.md) | 订单验签、过期拒绝、relayer 限流、relay 信誉 |

---

## 项目定位与价值

| 文档 | 用途 |
|------|------|
| [项目价值与定位](./项目价值与定位.md) | 项目核心意义、差异化优势、现实对比、发展路径、愿景 |
| [项目分析与借鉴](./项目分析与借鉴.md) | 对标 Bisq/Haveno/DCRDEX、架构增强、部署优化、上线奖励与防 Sybil 设计 |
| [主网上线与优化总览](./主网上线与优化总览.md) | 项目现状、DEX 对比、部署/Relayer/激励/防 Sybil 与上线 checklist（2026-02-09 汇总） |

## 核心设计文档

| 文档 | 用途 |
|------|------|
| [概念设计文档](./概念设计文档.md) | 愿景、去中心化原则、经济模型、治理规则、Phase 1–4 路线、文档维护原则 |
| [规划与路线图](./规划与路线图.md) | 阶段对照、已完成项、近期优先级、Phase 3/4 大块、建议执行顺序 |
| [Phase2-设计文档](./Phase2-设计文档.md) | 节点类型、数据同步、保留期（统一两周）、贡献度量与 M1–M4 |
| [Phase3-设计文档](./Phase3-设计文档.md) | 链下订单簿、撮合节点、中继规模化、经济模型细化 |
| [技术架构说明](./技术架构说明.md) | 分层架构、订单/成交结构、Gossip Topic、数据流、数据保留策略 |

## 接口与合约

| 文档 | 用途 |
|------|------|
| [API-接口说明](./API-接口说明.md) | 合约 ABI、链配置、Settlement/AMMPool/Governance 地址与调用 |
| [贡献奖励接口](./贡献奖励接口.md) | 贡献证明格式、链上校验、贡献分、奖励池与领取 |
| [公开API文档](./公开API文档.md) | 第三方接入指南：节点 HTTP API、EIP-712 签名、SDK 示例、合规说明 |
| [SDK 文档](../sdk/README.md) | JavaScript/TypeScript 和 Go SDK，便于第三方集成 |

## 功能模块设计

| 文档 | 用途 |
|------|------|
| [信誉机制说明](./信誉机制说明.md) | 无需准入但按信誉分分配奖励的实现说明 |
| [信誉分配示例](./信誉分配示例.md) | 按信誉分分配奖励的详细示例和计算说明 |
| [节点入网说明](./节点入网说明.md) | 节点入网无任何条件，完全开放的说明 |
| [不发行代币说明](./不发行代币说明.md) | 明确说明不发行项目自己的治理代币，使用贡献分和信誉分进行治理 |

## 功能模块实现

| 文档 | 用途 |
|------|------|
| [流动性补充与治理执行指南](./流动性补充与治理执行指南.md) | 为 AMM 池添加流动性和执行治理提案的完整指南 |
| [流动性贡献分设计](./流动性贡献分设计.md) | 节点注入流动性获得贡献分的机制设计 |
| [流动性贡献分实现指南](./流动性贡献分实现指南.md) | 流动性贡献分的实现和使用方法 |
| [DAO扩展设计](./DAO扩展设计.md) | DAO 治理机制的扩展功能设计（提案元数据、委托投票、取消机制等） |
| [DAO扩展实现指南](./DAO扩展实现指南.md) | DAO 扩展功能的使用方法和最佳实践 |
| [多节点与共识设计](./多节点与共识设计.md) | 分片按交易对（方案 B）和多节点共识（方案 C）的设计文档 |
| [多节点与共识实现指南](./多节点与共识实现指南.md) | 多节点撮合的实现和使用方法 |
| [跨链桥接完整指南](./跨链桥接完整指南.md) | LayerZero OApp 跨链桥接：设计、快速开始、实现、部署与测试（已整合） |

## 部署与运维

| 文档 | 用途 |
|------|------|
| [部署与使用说明](./部署与使用说明.md) | 环境、部署顺序、前端配置、治理流程 |
| [部署-Railway与Fly](./部署-Railway与Fly.md) | **按功能**：前端 Pages、节点 Railway/Fly.io、联调与日常更新；含前端功能模块对照 |
| [主网部署指南](./主网部署指南.md) | Ethereum 主网部署步骤与前端构建 |
| [主网试运行指南](./主网试运行指南.md) | 主网试运行的完整流程：部署、验证、测试、监控 |
| [Polygon 部署指南](./Polygon部署指南.md) | Polygon 主网部署与前端 build:polygon |
| [治理部署与提案执行指南](./治理部署与提案执行指南.md) | 治理部署、创建提案、投票、执行 |
| [治理闭环-Sepolia操作清单](./治理闭环-Sepolia操作清单.md) | Sepolia 治理闭环步骤、7 天后执行脚本 |
| [节点部署](./节点部署.md) | 节点运行与配置（含 retention_months） |
| [节点发现与Bootstrap](./节点发现与Bootstrap.md) | Bootstrap 配置、DHT、多区域连通性 |
| [Relay部署与Nginx](./Relay部署与Nginx.md) | 轻量 relay（--mode=relay）、Nginx 反代 wss、Certbot HTTPS |
| [TVL追踪建议](./TVL追踪建议.md) | 上线后 TVL 监控：DefiLlama、Dune、自建脚本（scripts/tvl_example.py） |
| [安装包构建指南](./安装包构建指南.md) | Windows 安装包/便携版构建（已整合） |

## 使用与验证

| 文档 | 用途 |
|------|------|
| [快速开始](./快速开始.md) | 一键启动、手动启动、功能测试、常见问题 |
| [前端验证-订单簿](./前端验证-订单簿.md) | 本地节点 + 前端验证订单簿、下单、撤单、成交与结算 |
| [价格与结算服务使用说明](./价格与结算服务使用说明.md) | pricefeed 周均价（CoinGecko/JSON）、贡献结算用 |
| [手机端开发指南](./手机端开发指南.md) | PWA、原生/RN/Flutter（Phase 4）、节点 API 与缓存 |
| [手机端架构与数据保存策略](./手机端架构与数据保存策略.md) | 专注手机端时的贡献分、数据保存位置和访问方式 |
| [前端单元测试说明](./前端单元测试说明.md) | Vitest 使用方式、当前覆盖（utils）、后续可做 |

## P2P 与客户端

| 文档 | 用途 |
|------|------|
| [P2P节点整合交易撮合指南](./P2P节点整合交易撮合指南.md) | 完整技术指南（环境、协议、撮合、链上结算、WebSocket、EIP-712、测试、Docker） |

## 优化与实现指南

| 文档 | 用途 | 优先级 |
|------|------|--------|
| [优化与改进清单](./优化与改进清单.md) | 基于当前状态的关键优化点：性能瓶颈、一致性问题、安全加固、测试部署等 | 参考 |
| [快速优化实现指南](./快速优化实现指南.md) | 高优先级快速优化方案：价格参考集成、钱包优化、手续费透明化（1-2 天可完成） | 🔴 高 |
| [公开数据展示实现指南](./公开数据展示实现指南.md) | 流动性池余额、奖励池余额、交易记录 - 所有人都能看到的透明数据 | 🔴 高 |
| [贡献分领取机制实现指南](./贡献分领取机制实现指南.md) | 手动领取 vs 每周自动领取 - 适合手机端（PWA）的实现方案 | 🔴 高 |
| [上线奖励分发机制实现指南](./上线奖励分发机制实现指南.md) | 节点绑定钱包 + 上线时批量空投 - 激励节点运营者和开发者 | 🟡 中 |

## 记录与参考

| 文档 | 用途 |
|------|------|
| [完善记录](./完善记录.md) | P2P 节点整合交易撮合完成记录（2026-02）、后续优化与参考 |
| [公开API文档](./公开API文档.md) | 第三方接入指南：节点 HTTP API、EIP-712 签名、SDK 示例、合规说明 |

---

## 维护约定

- **以当时修改为准**：以每次修改时的内容为当前权威；代码与文档不一致时，以当时修改后的版本为准并同步另一方或注明例外。
- **保留更改前的说明，便于分析**：修改设计或规则时，不删除「此前规定」的表述；可在正文中保留「此前」「旧版」「变更前」的简短说明，或在文末增加「变更说明」「历史规定」小节，列明本次修改要点及修改前的关键内容，便于后续对比与原因分析。
- **随时更新设计文档**：功能、策略、阶段状态变更后，同步更新相关设计文档（概念设计、规划与路线图、Phase2/Phase3、技术架构说明等），避免文档滞后。
- **术语一致**：数据保留统一为「两周」；可投票人员为「最近 2 周活跃人员」；经济模型比例、节点类型、合约名称等与概念设计文档保持一致。
- **文档整理**：定期检查文档结构，合并重复文档，优化分类。

---

## 文档统计

- **总文档数**：约 42 个（2026-02-10 精简合并后）
- **核心设计文档**：5 个
- **实现指南**：15+ 个
- **部署运维文档**：8 个
- **优化与改进文档**：5 个
- **记录与参考**：完善记录、安装包构建指南、公开API 等

**最后更新**：2026-02-10（文档合并优化）
