# Windows 安装包构建说明

## 当前问题

构建过程中遇到 electron-builder 代码签名工具解压时的符号链接权限问题。这是 Windows 上的已知问题，需要管理员权限或使用开发模式。

## 解决方案

### 方案 1：使用管理员权限（推荐）

1. **以管理员身份运行 PowerShell**
2. 执行构建命令：
   ```powershell
   cd d:\P2P\frontend
   $env:CSC_IDENTITY_AUTO_DISCOVERY='false'
   npm run electron:build
   ```

### 方案 2：使用 GitHub Actions（推荐用于生产）

GitHub Actions 构建流程（`.github/workflows/build-windows.yml`）会自动处理权限问题：

1. 推送到 main 分支
2. 在 Actions 中查看构建进度
3. 从 Artifacts 下载安装包

### 方案 3：手动跳过代码签名

如果不需要代码签名，可以：

1. **清理缓存**（需要管理员权限）：
   ```powershell
   Remove-Item -Path "$env:LOCALAPPDATA\electron-builder\Cache\winCodeSign" -Recurse -Force
   ```

2. **使用环境变量禁用签名**：
   ```powershell
   $env:CSC_IDENTITY_AUTO_DISCOVERY='false'
   $env:SKIP_NOTARIZATION='true'
   npm run electron:build
   ```

### 方案 4：使用便携版（Portable）

修改 `package.json` 中的构建目标：

```json
"win": {
  "target": ["portable"]
}
```

便携版不需要安装，直接运行 `.exe` 文件。

## 构建状态

- ✅ 前端构建成功（`npm run build:electron`）
- ✅ 输出目录：`frontend/release/`
- ⚠️ 安装包构建需要管理员权限或使用 GitHub Actions

## 已完成的优化

1. ✅ 添加 @libp2p/tcp 依赖
2. ✅ 创建 Electron P2P 客户端服务
3. ✅ 集成到 main.js
4. ✅ 优化 vite.config.ts（树摇、代码分割）
5. ✅ 更新构建脚本
6. ✅ 性能优化配置（maxConnections, DHT）
7. ✅ 订单签名验证
8. ✅ electron-builder 配置

## 下一步

1. **使用 GitHub Actions 构建**（推荐）
2. **或以管理员权限运行本地构建**
3. **或使用便携版构建**（无需签名）

## 构建产物位置

- 安装包：`frontend/release/P2P 交易所 Setup 0.0.1.exe`
- 便携版：`frontend/release/P2P 交易所-0.0.1.exe`（如果使用 portable 目标）
