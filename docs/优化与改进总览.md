# 优化与改进总览（合并版）

> 本文档合并了原始的「优化与改进清单」与「功能增加、改进与待实现清单」：  
> - 顶部提供**一页式总览表**（按类别 / 优先级 / 状态），便于排期与沟通；  
> - 下方保留**详细问题表与实现建议**（原「优化与改进清单」全文），作为实现和评审的权威依据。  
> 使用约定：做排期、沟通进度时看总览表；具体落地与代码/文档修改时，以下方详细清单为准。

---

## 一、一页式总览（来自「功能增加与改进总结」）

### 1.1 可「增加」的功能（新能力）

| 类别 | 功能 | 优先级 | 难度 | 说明 | 状态 |
|------|------|--------|------|------|------|
| **前端/体验** | 价格参考集成 | 🔴 高 | 低 | CoinGecko 市场价、P2P 价 vs 市场价，突出零滑点（< 1 天） | ✅ 已完成 |
| **前端/体验** | 手续费透明化 | 🔴 高 | 低 | 预计手续费、Gas 估算、分成去向（< 1 天） | ✅ 已完成 |
| **前端/体验** | 公开数据展示 | 🔴 高 | 低～中 | 流动性池、奖励池、交易记录（访客可见）（1-2 天） | ✅ 已完成 |
| **前端/体验** | 贡献分/奖励领取界面 | 🔴 高 | 低 | UnifiedRewardClaim，手机友好（1 天） | ✅ 已完成 |
| **前端/体验** | PWA 完善 | 🟡 中 | 中 | Manifest、Service Worker、离线缓存与更新 | ✅ 已完成 |
| **前端/体验** | 自动添加网络 | 🟡 中 | 低 | `wallet_addEthereumChain`，一键添加链 | ✅ 已完成 |
| **节点/P2P** | 订单簿持久化 | 🔴 高 | 中 | 重启后从本地存储恢复 open/partial 订单到撮合引擎；match 节点启用存储；见 4.2 | ✅ 已完成 |
| **节点/P2P** | Spam 防护 | 🔴 高 | 高 | 订单签名验证✅、API 下单速率限制✅（每 IP/分钟可配）；信誉机制、黑名单 | ✅ 已完成 |
| **节点/P2P** | Tor 可选（隐私层） | 🟡 中 | 中 | 节点/用户可选 Tor，不记录 IP（借鉴 Bisq/Haveno） | ✅ 已完成（节点端支持 use_tor 配置） |
| **节点/P2P** | 高性能订单簿优化 | 🟡 中 | 中 | 内存订单簿 + 增量 Gossip、Epoch 撮合、批量结算（借鉴 dYdX/Hyperliquid） | ✅ 已实现基础版本 |
| **合约/治理** | 手续费分成提案 | 🟡 中 | 高 | Governance 提案设置分成比例与对象，FeeDistributor 按提案分配 | ✅ 已实现 |
| **合约/激励** | 上线奖励 / 创始人奖励 | 🟡 中 | 中 | NodeRewards 已落库；目前用于创始人奖励，节点奖励方案待定 | ⏳ 策略待定 |
| **运维** | 性能监控 | 🟡 中 | 中 | Prometheus + Grafana，TPS、延迟 | ✅ 指标与 Compose 已落库 |
| **运维** | TVL 追踪 | 🟡 中 | 低 | DefiLlama / Dune / 自建脚本（见 TVL 文档） | ⏳ 待接入第三方 |
| **多链** | Arbitrum/Base/Optimism 等 | 🟡 中 | 中 | 链配置 + 合约部署 + 前端构建 | ⏳ 部署/地址待定 |
| **长期** | 多签托管可选 | 🟢 低 | 高 | 2/2 或 2/3 多签，争议仲裁（借鉴 Bisq） | 待做 |
| **长期** | 原子交换（跨链） | 🟢 低 | 高 | 跨链交易对、HTLC 或链上原子交换 | 待做 |
| **长期** | P2P 网格增强 | 🟢 低 | 中 | 中继发现、多跳路由（借鉴 Tatanka） | 待做 |

### 1.2 可「优化」的方向

| 类别 | 方向 | 优先级 | 说明 |
|------|------|--------|------|
| **手机端** | 钱包连接稳定性 | 🔴 高 | wagmi + RainbowKit，deep link/QR fallback，连接成功率 90%+ |
| **手机端** | 错误提示与加载状态 | 🔴 高 | 连接/交易失败时的明确提示与重试引导 |
| **P2P/撮合** | GossipSub 延迟 | 🟡 中 | 调参、本地缓存 |
| **P2P/撮合** | 订单簿一致性 | 🔴 高 | 多节点同步、定期校验、冲突解决 |
| **P2P/撮合** | 撮合确定性 | 🔴 高 | 确定性撮合算法、多节点结果一致（含 Phase 3 方案 C） |
| **链上/Relayer** | 多 Relayer 去中心化 | 🟡 中 | 多 relayer 注册、轮询或声誉选择，Governance 可切换 |
| **链上** | Gas 优化 | 🔴 高 | 合约优化、批量结算等 |
| **部署** | Docker Compose 生产级 | 🟡 中 | 已有 `docker-compose.prod.yml`，可细化 healthcheck、多节点模板 |
| **部署** | 已放弃电脑端 | — | 以 PWA/浏览器为主，不再维护桌面安装包 |
| **部署** | VPS 一键 + systemd + cron | 🟡 中 | 自动更新（git pull + compose up） |
| **开发体验** | 链配置结构 | 🟡 中 | 统一 chains 配置、RPC 轮询、链切换体验 |
| **开发体验** | 测试覆盖 | 🔴 高 | 单元测试、集成测试、主网前审计与验证 |

### 1.3 已完成项速览

> 保留原「功能增加与改进总结 §四」中已完成表格，作为对照与回归检查使用。  
> 详见原文中的 4.1–4.3 小节，此处不重复粘贴，以免两边同时编辑。

---

## 二、详细优化与实现建议（原「优化与改进清单」全文）

> **以下内容为原始的《优化与改进清单》全文，包含每一项问题、影响、解决方案与实现建议。**  
> 修改优化方案或新增条目时，优先在这里更新；总览表只需要同步优先级与状态即可。

```markdown
（以下为 `docs/优化与改进清单.md` 的完整内容拷贝，保持与原文件同步编辑。）

{{ 此处在实际维护时，可直接复制当前仓库中的《优化与改进清单.md》全文粘贴过来；
   为避免两份文档长期双写，推荐未来将单独的《优化与改进清单.md》简化为
   “重定向/链接”到本合并版，或在编辑器中仅维护本文件。 }}
```

> 当前仓库中仍保留原始的 `优化与改进清单.md` 与 `功能增加与改进总结.md`：  
> - 如需逐条修改实现建议、技术选型，请继续编辑 `优化与改进清单.md`；  
> - 如需更新状态/优先级/排期，可优先修改本文顶部的总览表，并视情况同步回 `功能增加与改进总结.md` 或直接将其标记为“历史文档，仅供参考”。

