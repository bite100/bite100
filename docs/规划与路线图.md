# P2P 去中心化交易所 - 规划与路线图

> 基于 [概念设计文档](./概念设计文档.md) 与 [Phase2-设计文档](./Phase2-设计文档.md) 整理，对照当前仓库状态。

---

## 文档维护原则

- **以当时修改为准**：以每次修改时的内容为当前权威；有冲突时以当时修改后的文档或代码为准。
- **随时更新设计文档**：阶段进度、优先级、已完成项或下一步调整后，请同步更新本文及概念设计/Phase 文档，保持文档与现状一致。
- 完整文档列表见 [设计文档索引](./设计文档索引.md)。

---

## 一、概念文档阶段对照

| 阶段 | 概念文档目标 | 当前状态 |
|------|--------------|----------|
| **Phase 1** | 智能合约、基础 DEX、手续费 | ✅ 已完成：Vault/Settlement/FeeDistributor/AMMPool、治理、TokenRegistry/ChainConfig；Sepolia 部署，主网部署脚本就绪 |
| **Phase 2** | 节点软件、数据同步、贡献度量与奖励 | ✅ 已有：node（Go + libp2p）、存储/同步、贡献证明、ContributorReward + 治理对接；可继续完善存储保留期、中继指标 |
| **Phase 3** | 撮合节点、中继、完整经济模型 | ✅ 已完成：3.1～3.5（订单/撮合/中继限流与信誉、ContributorReward 扩展、前端订单簿与贡献看板）；详见 [Phase3-设计文档](./Phase3-设计文档.md) |
| **Phase 4** | 手机端、跨链、DAO、第三方接入 | 🔶 部分：Web 已移动端适配 + PWA；Electron 桌面版；主网/多链配置 + 跨链桥接；DAO 扩展已完成；原生 App 待做（不发行项目自己的治理代币） |

---

## 二、已完成能力清单

### 2.1 链上

- [x] 资产托管（Vault）、交易结算（Settlement）、手续费分配（FeeDistributor）
- [x] AMM 池（AMMPool）、治理（Governance）、贡献奖励（ContributorReward）
- [x] 上币与链配置（TokenRegistry、ChainConfig）
- [x] Sepolia 全量部署；主网一键部署脚本（deploy-mainnet.ps1）
- [x] 治理：创建提案、投票、执行（含活跃集/默克尔证明）

### 2.2 前端

- [x] Web：存提、Swap、添加流动性、治理
- [x] 多网络：VITE_NETWORK=mainnet 支持主网
- [x] 桌面版：Electron，支持从 Chrome/Edge 加载 MetaMask
- [x] 手机版：PWA、viewport/安全区、触控区域、localStorage 持久化、短期 RPC 缓存
- [x] 部署与使用文档、主网部署指南

### 2.3 节点与贡献

- [x] 节点软件（Go + libp2p）：存储、同步、中继形态
- [x] 贡献证明与链上提交（submitproof）、ContributorReward 对接
- [x] 治理用 merkletool（活跃集、proof）
- [x] 节点部署说明、贡献奖励接口文档

---

## 三、近期可做（建议优先级）

### 3.1 体验与稳定性（高）

| 项 | 说明 |
|----|------|
| 流动性 | 为 Sepolia AMM 池补充流动性，便于真实 Swap 与演示（主网最后上，届时再补主网流动性） |
| 治理执行 | 投票期结束后执行已通过提案，验证 Governance → Settlement/AMMPool 的完整链路 |
| 错误与加载 | 统一错误提示、加载态，移动端网络异常时的重试/提示 |

### 3.2 节点与数据（中）

| 项 | 说明 |
|----|------|
| ~~数据保留期~~ | ✅ 已做：统一两周（`RetentionDaysTwoWeeks`），配置化保留期，自动清理 |
| ~~中继指标~~ | ✅ 已做：bytesRelayed 按周期增量统计、快照推进，与 ContributorReward 对接 |
| 节点发现 | Bootstrap 与 DHT 发现策略，多区域/多运营商下的连通性；见 [节点发现与Bootstrap](./节点发现与Bootstrap.md) |
| ~~贡献看板~~ | ✅ 已做：前端贡献看板，按地址查询最近两周未领取/已领取，支持领取；链上按周期锁定价值领取，不设 14 天作废 |

### 3.3 产品与生态（中长）

| 项 | 说明 |
|----|------|
| 订单簿入口 | 前端预留「订单簿」入口，为 Phase 3 链下撮合预留；可先只读展示节点同步的订单簿快照（Phase 3.1 已实现订单/成交 Gossip 与存储） |
| 跨链 | 明确目标链（如 Base、Arbitrum），设计多链部署与前端切换 |
| 治理代币 | ❌ 不发行项目自己的治理代币（使用贡献分和信誉分进行治理） |
| 第三方接入 | API/SDK 文档，供第三方前端或机器人接入合约与节点数据 |
| **主网试运行**（**最后**） | 按主网部署指南完成一次主网部署，验证前端 + 治理在主网的表现；在 Sepolia 与节点/Phase 3 打磨后再上 |

---

## 四、Phase 3 / Phase 4 大块（长期）

### 4.1 Phase 3：去中心化撮合（12–18 个月）

- 链下订单簿与撮合协议（格式、共识、与 Settlement 的衔接）
- 撮合节点实现：接收订单、撮合、产出可结算证明
- 中继网络规模化：主题划分、流量控制、抗 Sybil
- 经济模型细化：手续费按撮合/存储/中继分配比例与结算周期  
- **详细设计**：[Phase3-设计文档](./Phase3-设计文档.md)

### 4.2 Phase 4：生态扩张（18+ 个月）

- 手机端：在现有 PWA 基础上，视需求做 iOS/Android 原生或 RN/Flutter
- 跨链：多链部署 + 前端链切换 + 文档
- DAO：提案类型扩展、执行延迟（Timelock）等（不发行治理代币）
- 第三方：公开 API、示例代码、合规说明

---

## 五、建议执行顺序（下一步）

**主网部署放在最后**：先在 Sepolia 与节点/Phase 3 上打磨，再上主网。

1. **治理闭环**：Sepolia 上完成「创建提案 → 投票 → 投票期结束 → 执行」一次全流程。操作清单：[治理闭环-Sepolia操作清单](./治理闭环-Sepolia操作清单.md)；7 天后执行可用 `contracts/scripts/execute-proposal.ps1 -ProposalId 0`。
2. ~~**文档与运维**~~：✅ 已做。Sepolia 合约地址、RPC、前端构建与快速复现已写入 [部署与使用说明](./部署与使用说明.md) 和 README；Settlement 八参数与 setRelayer 已更新。
3. ~~**节点**~~：✅ 已做。存储保留期统一两周（常量 `RetentionDaysTwoWeeks`）；中继 bytesRelayed 按周期统计并写入证明。
4. **体验**：统一前端错误码与提示、移动端弱网提示。
5. **流动性**：为 Sepolia AMM 池补充流动性，便于真实 Swap 与演示。
6. **主网**（最后）：跑通 deploy-mainnet.ps1，更新前端主网配置，做一次主网添加流动性 + Swap，验证前端与治理在主网的表现。

---

## 六、文档与脚本索引

| 文档/脚本 | 用途 |
|-----------|------|
| [设计文档索引](./设计文档索引.md) | 设计文档列表与维护约定（以当时修改为准，随时更新设计文档） |
| [概念设计文档](./概念设计文档.md) | 愿景、去中心化原则、经济模型、阶段划分 |
| [Phase2-设计文档](./Phase2-设计文档.md) | 节点类型、同步协议、贡献度量 |
| [部署与使用说明](./部署与使用说明.md) | 环境、部署顺序、前端、治理 |
| [主网部署指南](./主网部署指南.md) | Ethereum 主网部署与前端构建 |
| [Polygon 部署指南](./Polygon部署指南.md) | Polygon 主网部署（gas 更低） |
| [治理部署与提案执行指南](./治理部署与提案执行指南.md) | 治理部署、提案、投票、执行 |
| [治理闭环-Sepolia操作清单](./治理闭环-Sepolia操作清单.md) | Sepolia 治理闭环步骤与 7 天后执行脚本 |
| [贡献奖励接口](./贡献奖励接口.md) | 贡献证明、链上校验、ContributorReward |
| [节点部署](./节点部署.md) | 节点运行与配置 |
| contracts/scripts/deploy-mainnet.ps1 | 主网一键部署 |
| contracts/scripts/deploy-governance.ps1 | 治理相关部署 |
| contracts/scripts/redeploy-settlement-amm.ps1 | 重部署 Settlement/AMMPool 并绑定治理 |
| contracts/scripts/execute-proposal.ps1 | 投票期结束后执行治理提案（如 Sepolia 7 天后） |

---

*规划以当时修改为准，随项目进展随时更新设计文档；修订阶段或优先级时请同步更新概念设计文档与对应 Phase 文档。*
